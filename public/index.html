<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IMPOSTER - Online Multiplayer</title>
    <script src="/socket.io/socket.io.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;700;800;900&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Space Grotesk', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1e293b 0%, #581c87 50%, #1e293b 100%);
            min-height: 100vh;
            color: white;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .screen {
            display: none;
        }

        .screen.active {
            display: block;
        }

        .card {
            background: rgba(30, 41, 59, 0.8);
            backdrop-filter: blur(20px);
            border-radius: 1.5rem;
            padding: 2rem;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(168, 85, 247, 0.2);
        }

        .title {
            text-align: center;
            font-size: 4rem;
            font-weight: 900;
            margin-bottom: 1rem;
            letter-spacing: -2px;
        }

        .subtitle {
            text-align: center;
            color: #c084fc;
            font-size: 1.25rem;
            margin-bottom: 2rem;
        }

        input, select, textarea {
            width: 100%;
            padding: 1rem;
            background: rgba(15, 23, 42, 0.5);
            border: 2px solid #334155;
            border-radius: 0.75rem;
            color: white;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #a855f7;
        }

        input::placeholder, textarea::placeholder {
            color: #64748b;
        }

        button {
            padding: 1rem 1.5rem;
            border: none;
            border-radius: 0.75rem;
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-primary {
            background: linear-gradient(135deg, #9333ea 0%, #db2777 100%);
            color: white;
            box-shadow: 0 10px 30px rgba(147, 51, 234, 0.5);
        }

        .btn-primary:hover:not(:disabled) {
            transform: scale(1.02);
            box-shadow: 0 15px 40px rgba(147, 51, 234, 0.6);
        }

        .btn-secondary {
            background: #475569;
            color: white;
        }

        .btn-secondary:hover:not(:disabled) {
            background: #334155;
        }

        .btn-success {
            background: linear-gradient(135deg, #059669 0%, #10b981 100%);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc2626 0%, #f97316 100%);
            color: white;
        }

        .player-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .player-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: rgba(15, 23, 42, 0.5);
            border-radius: 0.75rem;
        }

        .player-status {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #10b981;
        }

        .submissions-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            max-height: 400px;
            overflow-y: auto;
        }

        .submission-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: rgba(15, 23, 42, 0.5);
            border-radius: 0.75rem;
        }

        .round-badge {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(168, 85, 247, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #c084fc;
            font-weight: 700;
            font-size: 0.875rem;
        }

        /* Timer Styles */
        .timer-container {
            position: relative;
            width: 120px;
            height: 120px;
            margin: 0 auto 1rem;
        }

        .timer-circle {
            transform: rotate(-90deg);
        }

        .timer-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2rem;
            font-weight: 900;
        }

        .timer-warning {
            color: #f59e0b;
        }

        .timer-danger {
            color: #ef4444;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Submissions Table */
        .submissions-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
        }

        .submissions-table thead th {
            background: rgba(168, 85, 247, 0.2);
            padding: 1rem;
            text-align: left;
            position: sticky;
            top: 0;
            z-index: 10;
            border-bottom: 2px solid #a855f7;
        }

        .submissions-table tbody td {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid rgba(100, 116, 139, 0.2);
        }

        .submissions-table tbody tr:hover {
            background: rgba(168, 85, 247, 0.1);
        }

        .round-cell {
            font-weight: 700;
            color: #c084fc;
        }

        /* Vote Results */
        .vote-results {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .vote-result-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem;
            background: rgba(15, 23, 42, 0.5);
            border-radius: 0.75rem;
        }

        .vote-tally {
            display: flex;
            gap: 0.25rem;
            align-items: center;
        }

        .vote-mark {
            width: 8px;
            height: 24px;
            background: #a855f7;
            border-radius: 2px;
        }

        /* Rating */
        .rating-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem;
            background: rgba(15, 23, 42, 0.5);
            border-radius: 0.75rem;
            margin-bottom: 0.75rem;
        }
        
        .rating-item.rated {
            opacity: 0.6;
            pointer-events: none;
        }

        .rating-buttons {
            display: flex;
            gap: 0.5rem;
        }

        .points-display {
            font-size: 0.875rem;
            color: #c084fc;
            margin-left: 1rem;
        }

        /* Spectator */
        .player-item.spectator {
            opacity: 0.6;
            border: 1px dashed #64748b;
        }

        .spectator-banner {
            background: rgba(100, 116, 139, 0.3);
            border: 2px solid #64748b;
            padding: 1rem;
            border-radius: 0.75rem;
            text-align: center;
            margin-bottom: 1rem;
        }

        .role-spectator {
            color: #64748b;
        }

        /* Audio Control */
        .audio-control {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            padding: 1rem;
            background: rgba(30, 41, 59, 0.9);
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s;
            z-index: 100;
            border: 2px solid rgba(168, 85, 247, 0.5);
        }

        .audio-control:hover {
            transform: scale(1.1);
            box-shadow: 0 10px 30px rgba(168, 85, 247, 0.5);
        }

        .grid {
            display: grid;
            gap: 1.5rem;
        }

        .grid-2 {
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        }

        .info-box {
            padding: 1.5rem;
            background: rgba(15, 23, 42, 0.5);
            border-radius: 0.75rem;
            border: 1px solid rgba(168, 85, 247, 0.2);
        }

        .info-label {
            color: #94a3b8;
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
        }

        .info-value {
            font-size: 1.75rem;
            font-weight: 900;
        }

        .role-imposter {
            color: #ef4444;
        }

        .role-player {
            color: #10b981;
        }

        .lobby-code {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: rgba(168, 85, 247, 0.3);
            border-radius: 0.5rem;
            border: 1px solid rgba(168, 85, 247, 0.5);
        }

        .lobby-code span {
            font-family: 'Courier New', monospace;
            font-weight: 700;
            font-size: 1.25rem;
        }

        .current-player-highlight {
            background: rgba(16, 185, 129, 0.3) !important;
            border: 2px solid #10b981;
        }

        .settings-group {
            margin-bottom: 1.5rem;
        }

        .settings-label {
            display: block;
            color: #cbd5e1;
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .vote-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .leaderboard {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .leaderboard-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1.5rem;
            background: rgba(15, 23, 42, 0.5);
            border-radius: 0.75rem;
        }

        .leaderboard-item.first {
            background: linear-gradient(135deg, rgba(234, 179, 8, 0.3), rgba(234, 88, 12, 0.3));
            border: 2px solid rgba(234, 179, 8, 0.5);
        }

        .rank {
            font-size: 1.5rem;
            font-weight: 900;
        }

        .rank.first { color: #eab308; }
        .rank.second { color: #94a3b8; }
        .rank.third { color: #f97316; }

        .toast {
            position: fixed;
            top: 2rem;
            right: 2rem;
            padding: 1rem 1.5rem;
            background: rgba(239, 68, 68, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 0.75rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            z-index: 1000;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .icon {
            width: 1.25rem;
            height: 1.25rem;
        }

        .divider {
            position: relative;
            margin: 1.5rem 0;
            text-align: center;
        }

        .divider::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: #334155;
        }

        .divider span {
            position: relative;
            padding: 0 1rem;
            background: rgba(30, 41, 59, 0.8);
            color: #64748b;
            font-size: 0.875rem;
        }

        @media (max-width: 768px) {
            .title {
                font-size: 2.5rem;
            }
            
            .grid-2 {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Audio Control Button -->
    <div class="audio-control" onclick="toggleAudio()" title="Musik ein/aus">
        <svg id="audio-icon" class="icon" style="width: 1.5rem; height: 1.5rem;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"></path>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2"></path>
        </svg>
    </div>

    <div class="container">
        <!-- Join Screen -->
        <div id="join-screen" class="screen active">
            <div style="max-width: 500px; margin: 0 auto; padding-top: 4rem;">
                <div style="text-align: center; margin-bottom: 2rem;">
                    <div style="display: inline-block; padding: 1rem; background: rgba(168, 85, 247, 0.2); border-radius: 50%; margin-bottom: 1rem;">
                        <svg class="icon" style="width: 4rem; height: 4rem;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                        </svg>
                    </div>
                    <h1 class="title">IMPOSTER</h1>
                    <p class="subtitle">Wer l√ºgt? Wer sagt die Wahrheit?</p>
                </div>

                <div class="card">
                    <input type="text" id="player-name" placeholder="Dein Spielername" style="margin-bottom: 1rem;">
                    
                    <button class="btn-primary" style="width: 100%; margin-bottom: 1rem;" onclick="createLobby()">
                        <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"></path>
                        </svg>
                        Lobby Hosten
                    </button>

                    <div class="divider"><span>oder</span></div>

                    <input type="text" id="lobby-code" placeholder="Lobby-Code" style="margin-bottom: 1rem; text-transform: uppercase;">
                    
                    <button class="btn-secondary" style="width: 100%;" onclick="joinLobby()">
                        <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
                        </svg>
                        Lobby Beitreten
                    </button>
                </div>

                <div style="margin-top: 1.5rem; text-align: center; color: #64748b; font-size: 0.875rem;">
                    Mindestens 3 Spieler erforderlich
                </div>
            </div>
        </div>

        <!-- Lobby Screen -->
        <div id="lobby-screen" class="screen">
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                    <div>
                        <h2 style="font-size: 2rem; font-weight: 900; margin-bottom: 0.5rem;">Wartelobby</h2>
                        <div class="lobby-code">
                            <span style="color: #c084fc;">Code:</span>
                            <span id="current-lobby-code"></span>
                        </div>
                    </div>
                    <button class="btn-danger" onclick="leaveLobby()">
                        <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                        </svg>
                        Verlassen
                    </button>
                </div>

                <div class="grid grid-2">
                    <div class="info-box">
                        <h3 style="font-weight: 700; margin-bottom: 1rem;">
                            <svg class="icon" style="display: inline;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"></path>
                            </svg>
                            Spieler (<span id="player-count">0</span>)
                        </h3>
                        <div id="player-list" class="player-list"></div>
                    </div>

                    <div id="settings-panel" class="info-box" style="display: none;">
                        <h3 style="font-weight: 700; margin-bottom: 1rem;">
                            <svg class="icon" style="display: inline;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                            </svg>
                            Spieleinstellungen
                        </h3>
                        
                        <div class="settings-group">
                            <label class="settings-label">Wort-Modus</label>
                            <select id="word-mode" onchange="updateSettings()">
                                <option value="random">Zuf√§llig</option>
                                <option value="custom">Eigene W√∂rter</option>
                            </select>
                        </div>

                        <div id="category-group" class="settings-group">
                            <label class="settings-label">Kategorie</label>
                            <select id="category" onchange="updateSettings()">
                                <option value="tiere">Tiere</option>
                                <option value="objekte">Objekte</option>
                                <option value="orte">Orte</option>
                                <option value="aktivitaeten">Aktivit√§ten</option>
                                <option value="essen">Essen</option>
                            </select>
                        </div>

                        <div id="custom-words-group" class="settings-group" style="display: none;">
                            <label class="settings-label">Eigene W√∂rter (Komma-getrennt)</label>
                            <textarea id="custom-words" rows="3" placeholder="z.B. Apfel, Banane, Orange" onchange="updateSettings()"></textarea>
                        </div>
                    </div>
                </div>

                <button id="start-game-btn" class="btn-success" style="width: 100%; margin-top: 2rem; display: none;" onclick="startGame()">
                    <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    Spiel Starten
                </button>

                <div id="waiting-message" style="text-align: center; color: #94a3b8; margin-top: 2rem; display: none;">
                    Warte auf den Host, um das Spiel zu starten...
                </div>
            </div>
        </div>

        <!-- Game Screen -->
        <div id="game-screen" class="screen">
            <div id="spectator-banner" class="spectator-banner" style="display: none;">
                <strong>üëÅÔ∏è Spectator-Modus</strong><br>
                Du schaust zu und kannst im n√§chsten Match mitspielen!
            </div>

            <!-- Zuschauer-Liste -->
            <div id="spectators-sidebar" style="position: fixed; right: 1rem; top: 50%; transform: translateY(-50%); background: rgba(30, 41, 59, 0.9); padding: 1rem; border-radius: 1rem; border: 2px solid rgba(100, 116, 139, 0.5); max-width: 200px; display: none;">
                <h4 style="font-weight: 700; margin-bottom: 0.5rem; font-size: 0.875rem; color: #94a3b8;">üëÅÔ∏è Zuschauer</h4>
                <div id="spectators-list" style="font-size: 0.875rem;"></div>
            </div>

            <div class="grid grid-2" style="margin-bottom: 1.5rem;">
                <div class="info-box">
                    <div class="info-label">Deine Rolle</div>
                    <div class="info-value" id="player-role"></div>
                </div>
                
                <div class="info-box">
                    <div class="info-label">Das Wort</div>
                    <div class="info-value" id="current-word"></div>
                </div>

                <div class="info-box">
                    <div class="info-label">Runde</div>
                    <div class="info-value" style="color: #c084fc;" id="current-round"></div>
                </div>

                <div class="info-box">
                    <div class="info-label">Am Zug</div>
                    <div class="info-value" style="color: #10b981; font-size: 1.25rem;" id="current-player-name"></div>
                </div>
            </div>

            <div class="card" style="margin-bottom: 1.5rem;">
                <!-- Timer -->
                <div class="timer-container" id="timer-display" style="display: none;">
                    <svg class="timer-circle" width="120" height="120">
                        <circle cx="60" cy="60" r="54" fill="none" stroke="#334155" stroke-width="8"/>
                        <circle id="timer-progress" cx="60" cy="60" r="54" fill="none" stroke="#a855f7" stroke-width="8" 
                                stroke-dasharray="339.292" stroke-dashoffset="0"/>
                    </svg>
                    <div class="timer-text" id="timer-text">60</div>
                </div>

                <h3 style="font-weight: 700; margin-bottom: 1rem;">Dein Zug</h3>
                <div id="word-input-container" style="display: none;">
                    <div style="display: flex; gap: 1rem;">
                        <input type="text" id="word-input" placeholder="Gib dein Wort ein..." style="flex: 1;">
                        <button class="btn-primary" onclick="submitWord()">
                            <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                            </svg>
                            Senden
                        </button>
                    </div>
                </div>
                <div id="waiting-turn" style="text-align: center; color: #94a3b8; padding: 1rem; display: none;">
                    Warte auf den aktuellen Spieler...
                </div>
            </div>

            <div class="card">
                <h3 style="font-weight: 700; margin-bottom: 1rem;">Bisherige Antworten</h3>
                <div style="overflow-x: auto;">
                    <table class="submissions-table" id="submissions-table">
                        <thead id="submissions-header">
                            <tr>
                                <th>Runde</th>
                            </tr>
                        </thead>
                        <tbody id="submissions-body">
                            <tr>
                                <td colspan="100" style="text-align: center; color: #64748b; padding: 2rem;">
                                    Noch keine Antworten...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Voting Screen -->
        <div id="voting-screen" class="screen">
            <div class="card" style="margin-bottom: 1.5rem;">
                <h2 style="text-align: center; font-size: 2rem; font-weight: 900; margin-bottom: 1rem;">üó≥Ô∏è Voting-Phase</h2>
                <p style="text-align: center; color: #cbd5e1; margin-bottom: 2rem;">
                    Wer ist der Imposter? Oder wollt ihr eine weitere Runde spielen?
                </p>

                <div id="vote-options-container">
                    <div class="vote-grid" id="vote-options"></div>
                </div>

                <div id="vote-waiting" style="text-align: center; color: #94a3b8; margin-top: 2rem;">
                    <p style="margin-bottom: 0.5rem;">Warte auf alle Spieler...</p>
                    <p id="vote-count-text">0 / 0 Stimmen abgegeben</p>
                </div>

                <div id="vote-results-container" style="display: none; margin-top: 2rem;">
                    <h3 style="font-weight: 700; margin-bottom: 1rem; text-align: center;">üìä Voting-Ergebnisse</h3>
                    <div id="vote-results" class="vote-results"></div>
                    
                    <button id="evaluate-btn" class="btn-success" style="width: 100%; margin-top: 1.5rem; display: none;" onclick="evaluateVotes()">
                        ‚úÖ Ergebnis Auswerten
                    </button>
                </div>
            </div>

            <!-- Submissions √úbersicht -->
            <div class="card">
                <h3 style="font-weight: 700; margin-bottom: 1rem;">Bisherige Antworten</h3>
                <div style="overflow-x: auto;">
                    <table class="submissions-table">
                        <thead id="voting-submissions-header">
                            <tr>
                                <th>Runde</th>
                            </tr>
                        </thead>
                        <tbody id="voting-submissions-body">
                            <tr>
                                <td colspan="100" style="text-align: center; color: #64748b; padding: 2rem;">
                                    Keine Antworten...
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Zuschauer-Liste im Voting -->
            <div id="voting-spectators-sidebar" style="position: fixed; right: 1rem; top: 50%; transform: translateY(-50%); background: rgba(30, 41, 59, 0.9); padding: 1rem; border-radius: 1rem; border: 2px solid rgba(100, 116, 139, 0.5); max-width: 200px; display: none;">
                <h4 style="font-weight: 700; margin-bottom: 0.5rem; font-size: 0.875rem; color: #94a3b8;">üëÅÔ∏è Zuschauer</h4>
                <div id="voting-spectators-list" style="font-size: 0.875rem;"></div>
            </div>
        </div>

        <!-- Results Screen -->
        <div id="results-screen" class="screen">
            <div class="card" style="text-align: center;">
                <svg class="icon" style="width: 5rem; height: 5rem; margin: 0 auto 1rem;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"></path>
                </svg>
                <h2 style="font-size: 2.5rem; font-weight: 900; margin-bottom: 1rem;">Match Beendet!</h2>
                <p style="font-size: 1.25rem; color: #cbd5e1; margin-bottom: 2rem;" id="match-result"></p>

                <div class="info-box" id="rating-container" style="margin-bottom: 2rem; display: none;">
                    <h3 style="font-weight: 700; margin-bottom: 1rem;">Punkte vergeben</h3>
                    <p style="color: #94a3b8; margin-bottom: 1rem;">Bewerte die W√∂rter der anderen Spieler (je 1 Punkt pro Person)</p>
                    <div id="rating-list"></div>
                </div>

                <div id="imposter-no-rating" style="display: none; color: #ef4444; margin-bottom: 2rem; padding: 1rem; background: rgba(239, 68, 68, 0.1); border-radius: 0.75rem;">
                    üé≠ Als Imposter kannst du keine Punkte vergeben.
                </div>

                <div style="color: #64748b; margin-bottom: 2rem;">
                    Match <span id="match-number"></span> von 5
                </div>

                <button id="next-match-btn" class="btn-primary" style="display: none; margin: 0 auto;" onclick="nextMatch()">
                    ‚û°Ô∏è N√§chstes Match
                </button>

                <div id="waiting-host-message" style="color: #94a3b8; display: none;">
                    Warte auf den Host...
                </div>
            </div>
        </div>

        <!-- Final Screen -->
        <div id="final-screen" class="screen">
            <div class="card" style="text-align: center;">
                <svg class="icon" style="width: 6rem; height: 6rem; margin: 0 auto 1rem; animation: bounce 1s infinite;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"></path>
                </svg>
                
                <h2 style="font-size: 3rem; font-weight: 900; margin-bottom: 1rem;">üéâ Spiel Beendet!</h2>
                <p style="font-size: 1.25rem; color: #cbd5e1; margin-bottom: 2rem;">
                    Alle 5 Matches wurden gespielt!
                </p>

                <div class="info-box" style="margin-bottom: 2rem;">
                    <h3 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 1.5rem;">üèÜ Bestenliste</h3>
                    <div id="final-leaderboard" class="leaderboard"></div>
                </div>

                <button class="btn-primary" style="margin: 0 auto;" onclick="leaveLobby()">
                    üè† Zur√ºck zum Hauptmen√º
                </button>
            </div>
        </div>

        <!-- Imposter Guess Screen -->
        <div id="imposter-guess-screen" class="screen">
            <div class="card" style="text-align: center;">
                <h2 style="font-size: 2.5rem; font-weight: 900; margin-bottom: 1rem; color: #ef4444;">üé≠ Du wurdest entdeckt!</h2>
                <p style="font-size: 1.25rem; color: #cbd5e1; margin-bottom: 2rem;">
                    Du hast eine letzte Chance, das Wort zu erraten!
                </p>

                <div id="imposter-guess-input" style="display: none; max-width: 400px; margin: 0 auto;">
                    <input type="text" id="guess-input" placeholder="Dein Tipp..." style="margin-bottom: 1rem;">
                    <button class="btn-primary" style="width: 100%;" onclick="submitGuess()">
                        Wort Raten
                    </button>
                </div>

                <div id="imposter-waiting" style="color: #94a3b8;">
                    Warte auf die Entscheidung des Imposters...
                </div>
            </div>
        </div>

        <!-- Word Revealed Screen -->
        <div id="word-revealed-screen" class="screen">
            <div class="card" style="text-align: center;">
                <svg class="icon" style="width: 5rem; height: 5rem; margin: 0 auto 1rem; color: #ef4444;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                </svg>
                <h2 style="font-size: 2.5rem; font-weight: 900; margin-bottom: 1rem; color: #ef4444;">‚ö†Ô∏è Wort Offenbart!</h2>
                <p style="font-size: 1.25rem; color: #cbd5e1; margin-bottom: 1rem;" id="revealed-message"></p>
                <p style="font-size: 1.5rem; font-weight: 900; color: #c084fc; margin-bottom: 2rem;" id="revealed-word"></p>

                <button id="continue-reveal-btn" class="btn-primary" style="display: none; margin: 0 auto;" onclick="continueAfterReveal()">
                    ‚û°Ô∏è N√§chste Runde
                </button>

                <div id="waiting-host-reveal" style="color: #94a3b8; display: none;">
                    Warte auf den Host...
                </div>
            </div>
        </div>
    </div>

    <script>
        let socket;
        let currentLobby = null;
        let currentPlayer = null;
        let isHost = false;
        let playerRole = null;
        let playerWord = null;
        let timerInterval = null;
        let audioEnabled = false;
        let myRatings = {};
        let wasImposter = false;
        let audioContext = null;
        let tickSound = null;
        let backgroundMusicGain = null;
        let backgroundOscillators = [];

        // Audio Context initialisieren
        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
        }

        // Hintergrundmusik starten (sanfte Ambience)
        function startBackgroundMusic() {
            if (!audioEnabled || !audioContext || backgroundOscillators.length > 0) return;
            
            backgroundMusicGain = audioContext.createGain();
            backgroundMusicGain.gain.value = 0.03; // Sehr leise
            backgroundMusicGain.connect(audioContext.destination);
            
            // Mehrere Oszillatoren f√ºr angenehmen Ambient-Sound
            const frequencies = [220, 330, 440, 550]; // A3, E4, A4, C#5 - harmonisch
            
            frequencies.forEach((freq, index) => {
                const osc = audioContext.createOscillator();
                const oscGain = audioContext.createGain();
                
                osc.type = 'sine';
                osc.frequency.value = freq;
                
                oscGain.gain.value = 0.25;
                
                osc.connect(oscGain);
                oscGain.connect(backgroundMusicGain);
                
                osc.start(audioContext.currentTime + index * 0.5);
                backgroundOscillators.push({ osc, gain: oscGain });
            });
        }

        // Hintergrundmusik stoppen
        function stopBackgroundMusic() {
            backgroundOscillators.forEach(({ osc }) => {
                try {
                    osc.stop();
                } catch (e) {
                    // Already stopped
                }
            });
            backgroundOscillators = [];
        }

        // Tick-Sound generieren
        function playTickSound() {
            if (!audioEnabled || !audioContext) return;
            
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = 800;
            oscillator.type = 'sine';
            
            gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.1);
        }

        // Erfolgs-Sound
        function playSuccessSound() {
            if (!audioEnabled || !audioContext) return;
            
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime);
            oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.1);
            oscillator.type = 'sine';
            
            gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.3);
        }

        // Audio Functions
        function toggleAudio() {
            initAudio();
            audioEnabled = !audioEnabled;
            const icon = document.getElementById('audio-icon');
            
            if (audioEnabled) {
                audioContext.resume();
                startBackgroundMusic();
                icon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"></path>';
                showToast('üîä Sound aktiviert', 'success');
                playSuccessSound();
            } else {
                stopBackgroundMusic();
                icon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2"></path>';
            }
        }

        // Timer Functions
        function startTimer(duration) {
            stopTimer();
            
            let timeLeft = duration;
            const timerText = document.getElementById('timer-text');
            const timerProgress = document.getElementById('timer-progress');
            const circumference = 339.292;
            
            function updateTimer() {
                const offset = (timeLeft / duration) * circumference;
                timerProgress.style.strokeDashoffset = circumference - offset;
                timerText.textContent = timeLeft;
                
                // Tick-Sound bei jedem Sekunden-Wechsel
                if (timeLeft <= 10) {
                    playTickSound();
                }
                
                timerText.className = 'timer-text';
                if (timeLeft <= 10) {
                    timerText.classList.add('timer-danger');
                    timerProgress.style.stroke = '#ef4444';
                } else if (timeLeft <= 20) {
                    timerText.classList.add('timer-warning');
                    timerProgress.style.stroke = '#f59e0b';
                } else {
                    timerProgress.style.stroke = '#a855f7';
                }
                
                if (timeLeft <= 0) {
                    stopTimer();
                    return;
                }
                
                timeLeft--;
            }
            
            updateTimer();
            timerInterval = setInterval(updateTimer, 1000);
        }

        function stopTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
        }

        // Socket Verbindung
        function connectSocket() {
            socket = io();

            socket.on('connect', () => {
                console.log('Mit Server verbunden');
            });

            socket.on('lobby-created', ({ lobbyCode, lobby }) => {
                currentLobby = lobby;
                isHost = true;
                showScreen('lobby-screen');
                updateLobbyUI();
            });

            socket.on('lobby-joined', ({ lobby, isSpectator }) => {
                currentLobby = lobby;
                isHost = false;
                showScreen('lobby-screen');
                updateLobbyUI();
                
                if (isSpectator) {
                    showToast('Du bist als Zuschauer beigetreten. Spiel beim n√§chsten Match mit!', 'info');
                }
            });

            socket.on('lobby-updated', ({ lobby }) => {
                currentLobby = lobby;
                updateLobbyUI();
                
                if (lobby.status === 'playing' && getCurrentScreen() === 'lobby-screen') {
                    // Warte auf game-started Event
                }
            });

            socket.on('game-started', ({ lobby, role, word }) => {
                currentLobby = lobby;
                playerRole = role;
                playerWord = word;
                wasImposter = (role === 'imposter');
                myRatings = {};
                showScreen('game-screen');
                updateGameUI();
            });

            socket.on('game-updated', ({ lobby }) => {
                currentLobby = lobby;
                
                if (lobby.status === 'playing') {
                    updateGameUI();
                } else if (lobby.status === 'voting') {
                    // Auch Spectators sehen Voting-Screen
                    showScreen('voting-screen');
                    updateVotingUI();
                }
            });

            socket.on('vote-count-updated', ({ voteCount, totalVoters }) => {
                document.getElementById('vote-count-text').textContent = `${voteCount} / ${totalVoters} Stimmen abgegeben`;
            });

            socket.on('voting-complete', ({ lobby, voteResults }) => {
                currentLobby = lobby;
                displayVoteResults(voteResults);
            });

            socket.on('player-joined-spectator', ({ playerName }) => {
                showToast(`${playerName} schaut zu`, 'info');
            });

            socket.on('imposter-revealed', ({ lobby, imposterName, needsGuess }) => {
                currentLobby = lobby;
                showScreen('imposter-guess-screen');
                updateImposterGuessUI(imposterName);
            });

            socket.on('word-revealed', ({ lobby, playerName, word, newScore }) => {
                currentLobby = lobby;
                showScreen('word-revealed-screen');
                
                document.getElementById('revealed-message').textContent = 
                    `${playerName} hat versehentlich das gesuchte Wort eingegeben! -1 Punkt (Neuer Score: ${newScore})`;
                document.getElementById('revealed-word').textContent = `Das Wort war: "${word}"`;
                
                if (isHost) {
                    document.getElementById('continue-reveal-btn').style.display = 'block';
                    document.getElementById('waiting-host-reveal').style.display = 'none';
                } else {
                    document.getElementById('continue-reveal-btn').style.display = 'none';
                    document.getElementById('waiting-host-reveal').style.display = 'block';
                }
            });

            socket.on('match-ended', ({ lobby, winner, message, isFinal, matchCount, imposter }) => {
                currentLobby = lobby;
                wasImposter = (socket.id === imposter);
                myRatings = {};
                
                if (isFinal) {
                    showScreen('final-screen');
                    updateFinalUI();
                } else {
                    showScreen('results-screen');
                    updateResultsUI(message, matchCount);
                }
            });

            socket.on('rating-updated', ({ targetPlayerName, points, newTotal }) => {
                showToast(`${targetPlayerName}: ${points > 0 ? '+' : ''}${points} Punkt${points !== 1 && points !== -1 ? 'e' : ''} (Gesamt: ${newTotal})`, points > 0 ? 'success' : 'info');
            });

            socket.on('return-to-lobby', () => {
                showScreen('lobby-screen');
                updateLobbyUI();
            });

            socket.on('player-left', ({ playerName }) => {
                showToast(`${playerName} hat die Lobby verlassen`);
            });

            socket.on('new-host', ({ newHostName, newHostId }) => {
                if (socket.id === newHostId) {
                    isHost = true;
                    showToast(`Du bist jetzt der Host!`, 'success');
                    // UI updaten
                    if (currentLobby) {
                        updateLobbyUI();
                    }
                } else {
                    showToast(`${newHostName} ist jetzt der Host`, 'info');
                }
            });

            socket.on('error', ({ message }) => {
                showToast(message);
            });

            socket.on('disconnect', () => {
                showToast('Verbindung zum Server verloren');
                stopTimer();
            });
        }

        // Screen Management
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
            stopTimer();
        }

        function getCurrentScreen() {
            return document.querySelector('.screen.active').id;
        }

        // Lobby Functions
        function createLobby() {
            const playerName = document.getElementById('player-name').value.trim();
            if (!playerName) {
                showToast('Bitte gib einen Spielernamen ein!');
                return;
            }

            currentPlayer = playerName;
            
            const settings = {
                wordMode: 'random',
                customWords: [],
                category: 'tiere'
            };

            socket.emit('create-lobby', { playerName, settings });
        }

        function joinLobby() {
            const playerName = document.getElementById('player-name').value.trim();
            const lobbyCode = document.getElementById('lobby-code').value.trim().toUpperCase();
            
            if (!playerName || !lobbyCode) {
                showToast('Bitte gib Namen und Lobby-Code ein!');
                return;
            }

            currentPlayer = playerName;
            socket.emit('join-lobby', { playerName, lobbyCode });
        }

        function leaveLobby() {
            if (currentLobby) {
                socket.emit('leave-lobby', { lobbyCode: currentLobby.code });
            }
            currentLobby = null;
            currentPlayer = null;
            isHost = false;
            playerRole = null;
            playerWord = null;
            wasImposter = false;
            myRatings = {};
            stopTimer();
            showScreen('join-screen');
        }

        function updateSettings() {
            if (!isHost || !currentLobby) return;

            const wordMode = document.getElementById('word-mode').value;
            const category = document.getElementById('category').value;
            const customWordsText = document.getElementById('custom-words').value;
            const customWords = customWordsText.split(',').map(w => w.trim()).filter(w => w);

            const settings = {
                wordMode,
                category,
                customWords
            };

            // UI anpassen
            if (wordMode === 'custom') {
                document.getElementById('category-group').style.display = 'none';
                document.getElementById('custom-words-group').style.display = 'block';
            } else {
                document.getElementById('category-group').style.display = 'block';
                document.getElementById('custom-words-group').style.display = 'none';
            }

            socket.emit('update-settings', { lobbyCode: currentLobby.code, settings });
        }

        function startGame() {
            if (!isHost || !currentLobby) return;
            socket.emit('start-game', { lobbyCode: currentLobby.code });
        }

        // Game Functions
        function submitWord() {
            const input = document.getElementById('word-input');
            const word = input.value.trim();
            
            if (!word) return;

            socket.emit('submit-word', { lobbyCode: currentLobby.code, word });
            input.value = '';
            stopTimer();
        }

        function submitVote(target) {
            socket.emit('submit-vote', { lobbyCode: currentLobby.code, target });
            
            // UI Update: Buttons disablen
            document.querySelectorAll('#vote-options button').forEach(btn => {
                btn.disabled = true;
            });
        }

        function evaluateVotes() {
            socket.emit('evaluate-votes', { lobbyCode: currentLobby.code });
        }

        function submitGuess() {
            const guess = document.getElementById('guess-input').value.trim();
            if (!guess) return;

            socket.emit('imposter-guess', { lobbyCode: currentLobby.code, guess });
        }

        function continueAfterReveal() {
            if (!isHost) return;
            socket.emit('continue-after-reveal', { lobbyCode: currentLobby.code });
        }

        function ratePlayer(targetPlayerId, points) {
            // Pr√ºfen ob bereits bewertet
            if (myRatings[targetPlayerId]) {
                showToast('Du hast diesen Spieler bereits bewertet!');
                return;
            }

            socket.emit('rate-player', { lobbyCode: currentLobby.code, targetPlayerId, points });
            myRatings[targetPlayerId] = points;
            
            // UI update
            const ratingItem = document.querySelector(`[data-player-id="${targetPlayerId}"]`);
            if (ratingItem) {
                ratingItem.classList.add('rated');
                const pointsDisplay = ratingItem.querySelector('.points-display');
                if (pointsDisplay) {
                    pointsDisplay.textContent = `Vergeben: ${points > 0 ? '+' : ''}${points}`;
                }
            }
        }

        function nextMatch() {
            if (!isHost) return;
            socket.emit('next-match', { lobbyCode: currentLobby.code });
        }

        // UI Updates
        function updateLobbyUI() {
            if (!currentLobby) return;

            document.getElementById('current-lobby-code').textContent = currentLobby.code;
            
            // Aktive Spieler (keine Spectators)
            const activePlayers = currentLobby.players.filter(p => !p.isSpectator);
            const spectators = currentLobby.players.filter(p => p.isSpectator);
            
            document.getElementById('player-count').textContent = activePlayers.length;

            const playerList = document.getElementById('player-list');
            playerList.innerHTML = [
                ...activePlayers.map(player => `
                    <div class="player-item">
                        <div class="player-status"></div>
                        <span style="font-weight: 500;">${player.name}</span>
                        ${player.isHost ? '<span style="margin-left: auto; color: #fbbf24;">üëë Host</span>' : ''}
                    </div>
                `),
                ...spectators.map(player => `
                    <div class="player-item spectator">
                        <div class="player-status" style="background: #64748b;"></div>
                        <span style="font-weight: 500;">${player.name}</span>
                        <span style="margin-left: auto; color: #64748b;">üëÅÔ∏è Zuschauer</span>
                    </div>
                `)
            ].join('');

            // Settings und Start Button nur f√ºr Host
            if (isHost) {
                document.getElementById('settings-panel').style.display = 'block';
                document.getElementById('start-game-btn').style.display = 'flex';
                document.getElementById('waiting-message').style.display = 'none';
                
                // Settings nur setzen, nicht updaten (verhindert Loop)
                document.getElementById('word-mode').value = currentLobby.settings.wordMode;
                document.getElementById('category').value = currentLobby.settings.category;
                document.getElementById('custom-words').value = currentLobby.settings.customWords.join(', ');
                
                // UI anpassen ohne Server-Update
                const wordMode = currentLobby.settings.wordMode;
                if (wordMode === 'custom') {
                    document.getElementById('category-group').style.display = 'none';
                    document.getElementById('custom-words-group').style.display = 'block';
                } else {
                    document.getElementById('category-group').style.display = 'block';
                    document.getElementById('custom-words-group').style.display = 'none';
                }
            } else {
                document.getElementById('settings-panel').style.display = 'none';
                document.getElementById('start-game-btn').style.display = 'none';
                document.getElementById('waiting-message').style.display = 'block';
            }
        }

        function updateGameUI() {
            if (!currentLobby || !currentLobby.gameState) return;

            const gameState = currentLobby.gameState;
            
            // Spectator Banner
            if (playerRole === 'spectator') {
                document.getElementById('spectator-banner').style.display = 'block';
                document.getElementById('word-input-container').style.display = 'none';
                document.getElementById('waiting-turn').style.display = 'none';
                document.getElementById('timer-display').style.display = 'none';
            } else {
                document.getElementById('spectator-banner').style.display = 'none';
            }
            
            // Rolle und Wort
            const roleElement = document.getElementById('player-role');
            if (playerRole === 'imposter') {
                roleElement.innerHTML = 'üé≠ <span class="role-imposter">IMPOSTER</span>';
            } else if (playerRole === 'spectator') {
                roleElement.innerHTML = 'üëÅÔ∏è <span class="role-spectator">ZUSCHAUER</span>';
            } else {
                roleElement.innerHTML = 'üïµÔ∏è <span class="role-player">SPIELER</span>';
            }

            document.getElementById('current-word').textContent = playerWord ? `üìù ${playerWord}` : '‚ùì ???';
            document.getElementById('current-round').textContent = gameState.round;

            // Aktueller Spieler
            const currentPlayerId = gameState.playerOrder[gameState.currentPlayerIndex];
            const currentPlayerObj = currentLobby.players.find(p => p.id === currentPlayerId);
            const currentPlayerName = currentPlayerObj ? currentPlayerObj.name : 'Unbekannt';
            
            document.getElementById('current-player-name').textContent = currentPlayerName;

            // Input und Timer (nur f√ºr aktive Spieler, nicht f√ºr Spectators)
            if (playerRole !== 'spectator') {
                const isMyTurn = currentPlayerId === socket.id;
                if (isMyTurn) {
                    document.getElementById('word-input-container').style.display = 'block';
                    document.getElementById('waiting-turn').style.display = 'none';
                    document.getElementById('timer-display').style.display = 'block';
                    document.getElementById('word-input').focus();
                    
                    // Timer starten (60 Sekunden)
                    startTimer(60);
                } else {
                    document.getElementById('word-input-container').style.display = 'none';
                    document.getElementById('waiting-turn').style.display = 'block';
                    document.getElementById('timer-display').style.display = 'none';
                    stopTimer();
                }
            }

            // Submissions als Tabelle (auch f√ºr Spectators sichtbar)
            updateSubmissionsTable();
            
            // Zuschauer-Liste anzeigen wenn vorhanden
            updateSpectatorsList();
        }

        function updateSpectatorsList() {
            if (!currentLobby) return;
            
            const spectators = currentLobby.players.filter(p => p.isSpectator);
            const sidebar = document.getElementById('spectators-sidebar');
            const list = document.getElementById('spectators-list');
            
            if (spectators.length > 0) {
                sidebar.style.display = 'block';
                list.innerHTML = spectators.map(s => `
                    <div style="padding: 0.25rem 0; color: #cbd5e1;">‚Ä¢ ${s.name}</div>
                `).join('');
            } else {
                sidebar.style.display = 'none';
            }
        }

        function updateSubmissionsTable() {
            if (!currentLobby || !currentLobby.gameState) return;

            const gameState = currentLobby.gameState;
            const activePlayers = currentLobby.players.filter(p => !p.isSpectator);
            
            // Header erstellen
            const header = document.getElementById('submissions-header');
            header.innerHTML = '<tr><th>Runde</th>' + 
                activePlayers.map(p => `<th>${p.name}</th>`).join('') + 
                '</tr>';
            
            // Body erstellen
            const body = document.getElementById('submissions-body');
            
            if (gameState.submissions.length === 0) {
                body.innerHTML = `<tr><td colspan="${activePlayers.length + 1}" style="text-align: center; color: #64748b; padding: 2rem;">Noch keine Antworten...</td></tr>`;
                return;
            }
            
            // Gruppiere nach Runden
            const rounds = {};
            gameState.submissions.forEach(sub => {
                if (!rounds[sub.round]) rounds[sub.round] = {};
                rounds[sub.round][sub.playerId] = sub.word;
            });
            
            // Erstelle Zeilen
            body.innerHTML = Object.keys(rounds).sort((a, b) => a - b).map(round => {
                return `<tr>
                    <td class="round-cell">R${round}</td>
                    ${activePlayers.map(p => `<td>${rounds[round][p.id] || '-'}</td>`).join('')}
                </tr>`;
            }).join('');
        }

        function updateVotingUI() {
            if (!currentLobby || !currentLobby.gameState) return;

            const gameState = currentLobby.gameState;
            const voteOptions = document.getElementById('vote-options');
            const activePlayers = currentLobby.players.filter(p => !p.isSpectator);
            
            const hasVoted = gameState.votes[socket.id] !== undefined;
            const isSpectator = playerRole === 'spectator';
            
            let optionsHTML = `
                <button class="btn-primary" onclick="submitVote('CONTINUE')" ${hasVoted || isSpectator ? 'disabled' : ''}>
                    ‚û°Ô∏è Weiter Spielen
                </button>
            `;

            activePlayers.forEach(player => {
                const isMe = player.id === socket.id;
                optionsHTML += `
                    <button class="btn-danger" onclick="submitVote('${player.id}')" ${hasVoted || isMe || isSpectator ? 'disabled' : ''}>
                        üéØ ${player.name} voten
                    </button>
                `;
            });

            voteOptions.innerHTML = optionsHTML;

            // Vote count update
            const voteCount = Object.keys(gameState.votes).length;
            const totalVoters = activePlayers.length;
            document.getElementById('vote-count-text').textContent = `${voteCount} / ${totalVoters} Stimmen abgegeben`;
            
            // Submissions-Tabelle aktualisieren
            updateVotingSubmissionsTable();
            
            // Zuschauer-Liste anzeigen
            updateVotingSpectatorsList();
        }

        function updateVotingSpectatorsList() {
            if (!currentLobby) return;
            
            const spectators = currentLobby.players.filter(p => p.isSpectator);
            const sidebar = document.getElementById('voting-spectators-sidebar');
            const list = document.getElementById('voting-spectators-list');
            
            if (spectators.length > 0) {
                sidebar.style.display = 'block';
                list.innerHTML = spectators.map(s => `
                    <div style="padding: 0.25rem 0; color: #cbd5e1;">‚Ä¢ ${s.name}</div>
                `).join('');
            } else {
                sidebar.style.display = 'none';
            }
        }

        function updateVotingSubmissionsTable() {
            if (!currentLobby || !currentLobby.gameState) return;

            const gameState = currentLobby.gameState;
            const activePlayers = currentLobby.players.filter(p => !p.isSpectator);
            
            // Header erstellen
            const header = document.getElementById('voting-submissions-header');
            header.innerHTML = '<tr><th>Runde</th>' + 
                activePlayers.map(p => `<th>${p.name}</th>`).join('') + 
                '</tr>';
            
            // Body erstellen
            const body = document.getElementById('voting-submissions-body');
            
            if (gameState.submissions.length === 0) {
                body.innerHTML = `<tr><td colspan="${activePlayers.length + 1}" style="text-align: center; color: #64748b; padding: 2rem;">Keine Antworten...</td></tr>`;
                return;
            }
            
            // Gruppiere nach Runden
            const rounds = {};
            gameState.submissions.forEach(sub => {
                if (!rounds[sub.round]) rounds[sub.round] = {};
                rounds[sub.round][sub.playerId] = sub.word;
            });
            
            // Erstelle Zeilen
            body.innerHTML = Object.keys(rounds).sort((a, b) => a - b).map(round => {
                return `<tr>
                    <td class="round-cell">R${round}</td>
                    ${activePlayers.map(p => `<td>${rounds[round][p.id] || '-'}</td>`).join('')}
                </tr>`;
            }).join('');
        }

        function displayVoteResults(voteResults) {
            document.getElementById('vote-options-container').style.display = 'none';
            document.getElementById('vote-waiting').style.display = 'none';
            document.getElementById('vote-results-container').style.display = 'block';
            
            const resultsDiv = document.getElementById('vote-results');
            const activePlayers = currentLobby.players.filter(p => !p.isSpectator);
            
            // Erstelle Strichliste
            let resultsHTML = '';
            
            // Continue Option
            if (voteResults.CONTINUE) {
                resultsHTML += `
                    <div class="vote-result-item">
                        <span style="font-weight: 700;">‚û°Ô∏è Weiter Spielen</span>
                        <div class="vote-tally">
                            ${Array(voteResults.CONTINUE).fill('<div class="vote-mark"></div>').join('')}
                            <span style="margin-left: 0.5rem; font-weight: 700; color: #c084fc;">${voteResults.CONTINUE}</span>
                        </div>
                    </div>
                `;
            }
            
            // Spieler Optionen
            activePlayers.forEach(player => {
                const votes = voteResults[player.id] || 0;
                resultsHTML += `
                    <div class="vote-result-item">
                        <span style="font-weight: 700;">üéØ ${player.name}</span>
                        <div class="vote-tally">
                            ${Array(votes).fill('<div class="vote-mark"></div>').join('')}
                            <span style="margin-left: 0.5rem; font-weight: 700; color: #c084fc;">${votes}</span>
                        </div>
                    </div>
                `;
            });
            
            resultsDiv.innerHTML = resultsHTML;
            
            // Host kann auswerten
            if (isHost) {
                document.getElementById('evaluate-btn').style.display = 'block';
            }
        }

        function updateImposterGuessUI(imposterName) {
            if (!currentLobby || !currentLobby.gameState) return;

            const isImposter = currentLobby.gameState.imposter === socket.id;
            
            if (isImposter) {
                document.getElementById('imposter-guess-input').style.display = 'block';
                document.getElementById('imposter-waiting').style.display = 'none';
                document.getElementById('guess-input').focus();
            } else {
                document.getElementById('imposter-guess-input').style.display = 'none';
                document.getElementById('imposter-waiting').style.display = 'block';
            }
        }

        function updateResultsUI(message, matchCount) {
            document.getElementById('match-result').textContent = message;
            document.getElementById('match-number').textContent = matchCount;

            // Rating nur f√ºr Nicht-Imposter
            if (!wasImposter && playerRole !== 'spectator') {
                const ratingContainer = document.getElementById('rating-container');
                const ratingList = document.getElementById('rating-list');
                const otherPlayers = currentLobby.players.filter(p => p.id !== socket.id && !p.isSpectator);
                
                ratingList.innerHTML = otherPlayers.map(player => `
                    <div class="rating-item" data-player-id="${player.id}">
                        <div>
                            <span style="font-weight: 500;">${player.name}</span>
                            <span class="points-display"></span>
                        </div>
                        <div class="rating-buttons">
                            <button class="btn-success" style="padding: 0.5rem 1rem;" onclick="ratePlayer('${player.id}', 1)">+1</button>
                            <button class="btn-danger" style="padding: 0.5rem 1rem;" onclick="ratePlayer('${player.id}', -1)">-1</button>
                        </div>
                    </div>
                `).join('');
                
                ratingContainer.style.display = 'block';
                document.getElementById('imposter-no-rating').style.display = 'none';
            } else {
                document.getElementById('rating-container').style.display = 'none';
                if (wasImposter && playerRole !== 'spectator') {
                    document.getElementById('imposter-no-rating').style.display = 'block';
                }
            }

            // Next Match Button nur f√ºr Host
            if (isHost) {
                document.getElementById('next-match-btn').style.display = 'block';
                document.getElementById('waiting-host-message').style.display = 'none';
            } else {
                document.getElementById('next-match-btn').style.display = 'none';
                document.getElementById('waiting-host-message').style.display = 'block';
            }
        }

        function updateFinalUI() {
            const leaderboard = document.getElementById('final-leaderboard');
            const sortedPlayers = [...currentLobby.players].sort((a, b) => (b.totalPoints || 0) - (a.totalPoints || 0));

            leaderboard.innerHTML = sortedPlayers.map((player, idx) => {
                const rankClass = idx === 0 ? 'first' : idx === 1 ? 'second' : idx === 2 ? 'third' : '';
                
                return `
                    <div class="leaderboard-item ${idx === 0 ? 'first' : ''}">
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <div class="rank ${rankClass}">#${idx + 1}</div>
                            <span style="font-weight: 700; font-size: 1.125rem;">${player.name}</span>
                        </div>
                        <div style="font-size: 1.5rem; font-weight: 900; color: #c084fc;">
                            ${player.totalPoints || 0} Punkte
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Toast
        function showToast(message, type = 'error') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            document.body.appendChild(toast);

            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // Enter Key Support
        document.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                const screen = getCurrentScreen();
                
                if (screen === 'join-screen') {
                    const lobbyCodeInput = document.getElementById('lobby-code');
                    if (document.activeElement === lobbyCodeInput && lobbyCodeInput.value.trim()) {
                        joinLobby();
                    }
                } else if (screen === 'game-screen') {
                    const wordInput = document.getElementById('word-input');
                    if (document.activeElement === wordInput) {
                        submitWord();
                    }
                } else if (screen === 'imposter-guess-screen') {
                    const guessInput = document.getElementById('guess-input');
                    if (document.activeElement === guessInput) {
                        submitGuess();
                    }
                }
            }
        });

        // Word Mode Change
        document.getElementById('word-mode')?.addEventListener('change', updateSettings);

        // Initialize
        connectSocket();
    </script>
</body>
</html>
